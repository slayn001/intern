<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue-google-charts@0.3.2/dist/vue-google-charts.browser.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    </head>

    <body>
        
        <div id="app">
            <mb-chart></mb-chart> 
            <mc-chart></mc-chart>
        </div>
                
        <script type="text/x-template" id="mbc-template">
            <div id="mbc_div">
                <GChart
                    :settings="{packages: ['corechart', 'bar']}"    
                    :data="chartData"
                    :options="chartOptions"
                    :createChart="(el, google) => new google.charts.Bar(el)"
                    @ready="onChartReady"
                />
            </div>
        </script>
        <script type="text/x-template" id="mcc-template">
            <div id="mcc_div">
                <GChart
                    type="ColumnChart"
                    :settings="{packages: ['bar']}"
                    :options="chartOptions"
                    :data="chartData"
                    @ready="onChartReady"
                />
            </div>
        </script>
        <script>
            let mCChart = {
                template: "#mcc-template",
                data() {
                    return {
                        chartData: {},
                        chartOptions: {}
                    }
                },
                methods: {
                     onChartReady (chart, google) {
                         this.chartsLib = google
                         
                         $.ajax({
                            url: "http://localhost:3000/materialChart/mcchart?st=AZ&st=CO&st=CT&st=IL&st=IN&st=NJ&st=OH&st=PA&st=TX&st=WI",
                            dataType: "json",
                            async: false
                            })
                         .done((resp) => {
                             let data = new google.visualization.DataTable();
                             data.addColumn('string', 'State');
                             data.addColumn('number', 'Auto');
                             data.addColumn('number', 'Home')
                             data.addColumn('number', 'Pelp');
                             
                             resp.forEach((el) => {
                                 data.addRow([el.state, el.auto, el.home, el.pelp])
                             });
                             
                             this.chartData = data;
                         })
                         .fail((xhr) => {
                             console.log(xhr);
                         })
                    }   
                }
            }
            
            let mBChart = {
                template: "#mbc-template",
                data: function() {
                    return {
                        chartsLib: null,
                        chartData: JSON.parse($.ajax({
                            url: "http://localhost:3000/materialChart/mbchart",
                            dataType: "json",
                            async: false
                            }).responseText)
                    }
                },
                computed:{
                    chartOptions () {
                      if (!this.chartsLib) return null
                      return this.chartsLib.charts.Bar.convertOptions({
                        chart: {
                          title: 'Extracted to Date',
                        },
                        bars: 'horizontal', // Required for Material Bar Charts.
                        hAxis: { format: 'decimal' },
                        height: 400,
                        colors: ['#1b9e77', '#d95f02', '#7570b3']
                      })
                    }
                },
                methods: {
                     onChartReady (chart, google) {
                      this.chartsLib = google
                    }
                }
            }
            
            new Vue({
              el: "#app",
              components: { 'mc-chart': mCChart,
                            'mb-chart': mBChart }
            });
        </script>
    </body>
</html>

